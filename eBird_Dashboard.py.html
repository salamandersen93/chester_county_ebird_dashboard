<html>
<head>
<title>eBird_Dashboard.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
eBird_Dashboard.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">date</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">timedelta</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">from </span><span class="s1">sqlalchemy </span><span class="s0">import </span><span class="s1">create_engine</span>
<span class="s0">from </span><span class="s1">dash.dependencies </span><span class="s0">import </span><span class="s1">Input</span><span class="s0">, </span><span class="s1">Output</span>
<span class="s0">import </span><span class="s1">dash_core_components </span><span class="s0">as </span><span class="s1">dcc</span>
<span class="s0">import </span><span class="s1">dash_html_components </span><span class="s0">as </span><span class="s1">html</span>
<span class="s0">import </span><span class="s1">sqlite3</span>
<span class="s0">import </span><span class="s1">dash</span>
<span class="s0">import </span><span class="s1">dash_table</span>
<span class="s0">import </span><span class="s1">plotly.express </span><span class="s0">as </span><span class="s1">px</span>
<span class="s0">import </span><span class="s1">plotly.graph_objects </span><span class="s0">as </span><span class="s1">go</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span><span class="s0">, </span><span class="s1">timedelta</span>
<span class="s0">import </span><span class="s1">geopandas</span>
<span class="s0">import </span><span class="s1">collections</span><span class="s0">, </span><span class="s1">functools</span><span class="s0">, </span><span class="s1">operator</span>
<span class="s0">import </span><span class="s1">itertools</span>
<span class="s0">import </span><span class="s1">dash_bootstrap_components </span><span class="s0">as </span><span class="s1">dbc</span>

<span class="s2"># establish connection to sqlite database created in get_data.py</span>
<span class="s1">conn = sqlite3.connect(</span><span class="s3">&quot;C:/Users/mikea/Documents/Python Practice/PA_County_Dashboards/Data/save_pandas.db&quot;</span><span class="s1">)</span>
<span class="s1">cur = conn.cursor()</span>

<span class="s2"># set color theme for the page</span>
<span class="s1">colors = {</span>
    <span class="s3">'background'</span><span class="s1">: </span><span class="s3">'#FBFBFB'</span><span class="s0">,</span>
    <span class="s3">'text'</span><span class="s1">: </span><span class="s3">'#212F3C'</span>
<span class="s1">}</span>

<span class="s2"># bring in taxonomy database containing species information, species codes, etc.</span>
<span class="s1">PA_taxonomy_df = pd.read_csv(</span><span class="s3">r'C:\Users\mikea\Documents\Python Practice\PA_County_Dashboards\Data\PA_taxonomy.csv'</span><span class="s1">)</span>

<span class="s2"># this is the main data frame containing all information from the 'sightings' table</span>
<span class="s1">df = pd.read_sql_query(</span><span class="s3">&quot;select * from Sightings1;&quot;</span><span class="s0">, </span><span class="s1">conn)</span>

<span class="s2"># establishing data types</span>
<span class="s1">df[</span><span class="s3">'howMany'</span><span class="s1">] = pd.to_numeric(df[</span><span class="s3">'howMany'</span><span class="s1">])</span>
<span class="s1">df[</span><span class="s3">'obsDt'</span><span class="s1">] = pd.to_datetime(df[</span><span class="s3">'obsDt'</span><span class="s1">])</span>
<span class="s1">df[</span><span class="s3">'date'</span><span class="s1">] = pd.to_datetime(df[</span><span class="s3">'date'</span><span class="s1">])</span>

<span class="s2"># aggregating the data by number of sightings and time of day</span>
<span class="s1">species_sums_with_time = df.groupby([</span>
    <span class="s3">'comName'</span><span class="s0">, </span><span class="s3">'timeOfDay'</span>
    <span class="s1">]).agg(sightingCount=(</span><span class="s3">'howMany'</span><span class="s0">, </span><span class="s1">sum))</span>

<span class="s1">species_sums_with_time[</span><span class="s3">'sightingCount'</span><span class="s1">] = species_sums_with_time[</span><span class="s3">'sightingCount'</span><span class="s1">].fillna(</span><span class="s4">0</span><span class="s1">)</span>
<span class="s1">species_sums_with_time = species_sums_with_time.reset_index()</span>

<span class="s2"># aggregating the data by sighting count for the entire day (without time designation)</span>
<span class="s1">species_sums_without_time = species_sums_with_time.groupby([</span><span class="s3">'comName'</span><span class="s1">])[</span><span class="s3">'sightingCount'</span><span class="s1">].agg(</span><span class="s3">'sum'</span><span class="s1">).reset_index()</span>

<span class="s2"># creating list containing the links to the individual eBird species pages</span>
<span class="s1">bare_link = </span><span class="s3">'https://ebird.org/species/'</span>
<span class="s1">species_df_for_dict = pd.merge(species_sums_with_time</span><span class="s0">, </span><span class="s1">PA_taxonomy_df</span><span class="s0">, </span><span class="s1">on=</span><span class="s3">'comName'</span><span class="s1">)</span>
<span class="s1">species_df_for_dict = species_df_for_dict.groupby([</span><span class="s3">'comName'</span><span class="s0">, </span><span class="s3">'speciesCode'</span><span class="s1">])[</span><span class="s3">'sightingCount'</span><span class="s1">].agg(</span><span class="s3">'sum'</span><span class="s1">).reset_index()</span>
<span class="s1">species_df_for_dict = species_df_for_dict.sort_values(by=</span><span class="s3">'sightingCount'</span><span class="s0">, </span><span class="s1">ascending=</span><span class="s0">False</span><span class="s1">).reset_index()</span>
<span class="s1">species_df_for_dict = species_df_for_dict.drop(columns=[</span><span class="s3">'index'</span><span class="s1">])</span>
<span class="s1">species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">] = bare_link + species_df_for_dict.speciesCode.map(str)</span>
<span class="s1">species_df_for_dict = species_df_for_dict.nlargest(</span><span class="s4">20</span><span class="s0">,</span><span class="s3">'sightingCount'</span><span class="s1">)</span>
<span class="s1">species_df_for_dict = species_df_for_dict[[</span><span class="s3">'comName'</span><span class="s0">, </span><span class="s3">'link'</span><span class="s1">]]</span>
<span class="s1">specie_df_links = species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">].tolist()</span>

<span class="s2"># Figure 1 - sighting counts by time of day (top 20 overall species counts)</span>
<span class="s1">fig = px.bar(species_sums_with_time</span><span class="s0">,</span>
             <span class="s1">x=</span><span class="s3">'comName'</span><span class="s0">,</span>
             <span class="s1">y=</span><span class="s3">'sightingCount'</span><span class="s0">,</span>
             <span class="s1">color=</span><span class="s3">'timeOfDay'</span><span class="s0">,</span>
             <span class="s1">barmode=</span><span class="s3">'stack'</span><span class="s0">,</span>
             <span class="s1">labels={</span>
                 <span class="s3">&quot;comName&quot;</span><span class="s1">: </span><span class="s3">&quot;Species Name&quot;</span><span class="s0">,</span>
                 <span class="s3">&quot;sightingCount&quot;</span><span class="s1">: </span><span class="s3">&quot;Bird Count&quot;</span><span class="s0">,</span>
             <span class="s1">}</span><span class="s0">,</span>
             <span class="s1">title=</span><span class="s3">&quot;Top 20 Species Sightings (by count) by Time of Day&quot;</span><span class="s0">,</span>
             <span class="s1">template=</span><span class="s3">&quot;seaborn&quot;</span><span class="s0">,</span>
             <span class="s1">height=</span><span class="s4">500</span>
             <span class="s1">)</span>

<span class="s1">minc = </span><span class="s4">0</span>

<span class="s0">if </span><span class="s1">species_sums_with_time[</span><span class="s3">'sightingCount'</span><span class="s1">].max() &lt; </span><span class="s4">500</span><span class="s1">:</span>
    <span class="s1">maxc = species_sums_with_time[</span><span class="s3">'sightingCount'</span><span class="s1">].max()</span>
<span class="s0">else</span><span class="s1">:</span>
    <span class="s1">maxc = </span><span class="s4">1000</span>

<span class="s1">fig.update_layout(yaxis_autorange=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s1">fig.update_layout(yaxis_range=[minc</span><span class="s0">, </span><span class="s1">maxc])</span>

<span class="s1">fig.update_layout(barmode=</span><span class="s3">'stack'</span><span class="s0">, </span><span class="s1">xaxis={</span><span class="s3">'categoryorder'</span><span class="s1">:</span><span class="s3">'total descending'</span><span class="s1">})</span>
<span class="s1">fig.update_layout(xaxis_tickangle=-</span><span class="s4">45</span><span class="s1">)</span>
<span class="s1">fig.update_layout(xaxis=dict(range=[-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">19.5</span><span class="s1">]))</span>
<span class="s1">fig.update_layout(paper_bgcolor=colors[</span><span class="s3">'background'</span><span class="s1">])</span>
<span class="s1">fig.update_layout(</span>
    <span class="s1">title={</span>
        <span class="s3">'y'</span><span class="s1">:</span><span class="s4">0.98</span><span class="s0">,</span>
        <span class="s3">'x'</span><span class="s1">:</span><span class="s4">0.5</span><span class="s0">,</span>
        <span class="s3">'xanchor'</span><span class="s1">: </span><span class="s3">'center'</span><span class="s0">,</span>
        <span class="s3">'yanchor'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">margin=dict(</span>
        <span class="s1">b=</span><span class="s4">200</span><span class="s0">,</span>
        <span class="s1">t=</span><span class="s4">0</span><span class="s0">,</span>
        <span class="s1">pad=</span><span class="s4">10</span>
    <span class="s1">)</span>
<span class="s1">)</span>

<span class="s2"># df for second figure created. aggregating by location name and species name, get number of species seen per location</span>
<span class="s1">public_records_df = df[df[</span><span class="s3">'locationPrivate'</span><span class="s1">] != </span><span class="s3">'True'</span><span class="s1">]</span>
<span class="s1">public_records_counts_df = public_records_df.groupby([</span><span class="s3">'locName'</span><span class="s0">, </span><span class="s3">'comName'</span><span class="s1">]).size().reset_index(name=</span><span class="s3">&quot;visitCounts&quot;</span><span class="s1">)</span>
<span class="s1">public_records_counts_df.set_index([</span><span class="s3">'locName'</span><span class="s0">, </span><span class="s3">'comName'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s1">public_records_counts_df = public_records_counts_df.reset_index()</span>
<span class="s1">public_records_counts_df = public_records_counts_df[</span><span class="s3">'locName'</span><span class="s1">].value_counts().reset_index()</span>
<span class="s1">public_records_counts_df.columns = [</span><span class="s3">'locName'</span><span class="s0">, </span><span class="s3">'speciesCount'</span><span class="s1">]</span>

<span class="s2"># creating list containing the links to the individual eBird hot spot/location pages</span>
<span class="s1">bare_link_hotspot = </span><span class="s3">'https://ebird.org/hotspot/'</span>
<span class="s1">hotspot_df_for_dict = pd.merge(public_records_counts_df</span><span class="s0">, </span><span class="s1">public_records_df</span><span class="s0">, </span><span class="s1">on=</span><span class="s3">'locName'</span><span class="s1">)</span>
<span class="s1">hotspot_df_for_dict = hotspot_df_for_dict.groupby([</span><span class="s3">'locName'</span><span class="s0">, </span><span class="s3">'locId'</span><span class="s1">])[</span><span class="s3">'speciesCount'</span><span class="s1">].agg(</span><span class="s3">'sum'</span><span class="s1">).reset_index()</span>
<span class="s1">hotspot_df_for_dict = hotspot_df_for_dict.sort_values(by=</span><span class="s3">'speciesCount'</span><span class="s0">, </span><span class="s1">ascending=</span><span class="s0">False</span><span class="s1">).reset_index()</span>
<span class="s1">hotspot_df_for_dict = hotspot_df_for_dict.drop(columns=[</span><span class="s3">'index'</span><span class="s1">])</span>
<span class="s1">hotspot_df_for_dict = hotspot_df_for_dict.nlargest(</span><span class="s4">20</span><span class="s0">, </span><span class="s3">'speciesCount'</span><span class="s1">)</span>
<span class="s1">hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">] = bare_link_hotspot + hotspot_df_for_dict.locId.map(str)</span>
<span class="s1">hotspot_df_for_dict = hotspot_df_for_dict[[</span><span class="s3">'locName'</span><span class="s0">, </span><span class="s3">'link'</span><span class="s1">]]</span>
<span class="s1">hotspot_df_links = species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">].tolist()</span>

<span class="s2"># figure 2 - number of species sighted at each hot spot (top 20)</span>
<span class="s1">fig2 = px.bar(public_records_counts_df</span><span class="s0">,</span>
             <span class="s1">x=</span><span class="s3">'locName'</span><span class="s0">,</span>
             <span class="s1">y=</span><span class="s3">'speciesCount'</span><span class="s0">,</span>
             <span class="s1">color=</span><span class="s3">'speciesCount'</span><span class="s0">,</span>
             <span class="s1">barmode=</span><span class="s3">'stack'</span><span class="s0">,</span>
             <span class="s1">labels={</span>
                 <span class="s3">&quot;locName&quot;</span><span class="s1">: </span><span class="s3">&quot;Hotspot Name&quot;</span><span class="s0">,</span>
                 <span class="s3">&quot;speciesCount&quot;</span><span class="s1">: </span><span class="s3">&quot;Number of Species&quot;</span><span class="s0">,</span>
             <span class="s1">}</span><span class="s0">,</span>
             <span class="s1">title=</span><span class="s3">&quot;Top 20 Hotspots by Number of Species Sighted&quot;</span><span class="s0">,</span>
             <span class="s1">template=</span><span class="s3">&quot;seaborn&quot;</span><span class="s0">,</span>
             <span class="s1">height=</span><span class="s4">500</span><span class="s0">,</span>
             <span class="s1">color_continuous_scale=px.colors.sequential.Viridis</span>
             <span class="s1">)</span>
<span class="s1">fig2.update_layout(barmode=</span><span class="s3">'stack'</span><span class="s0">, </span><span class="s1">xaxis={</span><span class="s3">'categoryorder'</span><span class="s1">:</span><span class="s3">'total descending'</span><span class="s1">})</span>
<span class="s1">fig2.update_layout(xaxis_tickangle=-</span><span class="s4">50</span><span class="s1">)</span>
<span class="s1">fig2.update_layout(showlegend=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s1">fig2.update_layout(xaxis=dict(range=[-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">19.5</span><span class="s1">]))</span>
<span class="s1">fig2.update_layout(paper_bgcolor=colors[</span><span class="s3">'background'</span><span class="s1">])</span>
<span class="s1">fig2.update_layout(</span>
    <span class="s1">title={</span>
        <span class="s3">'y'</span><span class="s1">:</span><span class="s4">0.98</span><span class="s0">,</span>
        <span class="s3">'x'</span><span class="s1">:</span><span class="s4">0.5</span><span class="s0">,</span>
        <span class="s3">'xanchor'</span><span class="s1">: </span><span class="s3">'center'</span><span class="s0">,</span>
        <span class="s3">'yanchor'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">}</span><span class="s0">,</span>
    <span class="s1">margin=dict(</span>
        <span class="s1">b=</span><span class="s4">280</span><span class="s0">,</span>
        <span class="s1">t=</span><span class="s4">0</span><span class="s0">,</span>
        <span class="s1">pad=</span><span class="s4">10</span>
    <span class="s1">)</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s2"># establishing connections to the 'notable sightings' data frame - contains information around rare bird sightings</span>
<span class="s1">notable_df = pd.read_sql_query(</span><span class="s3">&quot;select * from NotableSightings;&quot;</span><span class="s0">, </span><span class="s1">conn)</span>

<span class="s2"># using geopandas to create a geodataframe</span>
<span class="s1">notable_gdf = geopandas.GeoDataFrame(</span>
    <span class="s1">notable_df</span><span class="s0">, </span><span class="s1">geometry=geopandas.points_from_xy(notable_df.lng</span><span class="s0">, </span><span class="s1">notable_df.lat))</span>

<span class="s2"># establishing data types and sorting by date</span>
<span class="s1">notable_gdf[</span><span class="s3">'howMany'</span><span class="s1">] = notable_gdf[</span><span class="s3">'howMany'</span><span class="s1">].fillna(</span><span class="s3">'1'</span><span class="s1">)</span>
<span class="s1">notable_gdf[</span><span class="s3">&quot;howMany&quot;</span><span class="s1">] = pd.to_numeric(notable_gdf[</span><span class="s3">&quot;howMany&quot;</span><span class="s1">])</span>
<span class="s1">notable_gdf[</span><span class="s3">&quot;lat&quot;</span><span class="s1">] = pd.to_numeric(notable_gdf[</span><span class="s3">&quot;lat&quot;</span><span class="s1">])</span>
<span class="s1">notable_gdf[</span><span class="s3">&quot;lng&quot;</span><span class="s1">] = pd.to_numeric(notable_gdf[</span><span class="s3">&quot;lng&quot;</span><span class="s1">])</span>
<span class="s1">notable_gdf = notable_gdf.sort_values(by=</span><span class="s3">'date'</span><span class="s1">)</span>

<span class="s2"># set min/max dates for xaxis of bubble map plot</span>
<span class="s1">min_date = notable_gdf.date.min()</span>
<span class="s1">max_date = notable_gdf.date.max()</span>

<span class="s2"># figure 5 - rare sightings by day bubble map</span>
<span class="s1">fig5 = px.scatter_mapbox(notable_gdf</span><span class="s0">, </span><span class="s1">lat=</span><span class="s3">&quot;lat&quot;</span><span class="s0">, </span><span class="s1">lon=</span><span class="s3">&quot;lng&quot;</span><span class="s0">, </span><span class="s1">animation_frame=</span><span class="s3">&quot;date&quot;</span><span class="s0">,</span>
            <span class="s1">size=</span><span class="s3">&quot;howMany&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;comName&quot;</span><span class="s0">, </span><span class="s1">hover_name=</span><span class="s3">&quot;comName&quot;</span><span class="s0">, </span><span class="s1">range_color=(</span><span class="s4">0</span><span class="s0">,</span><span class="s4">20</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">hover_data=[</span><span class="s3">&quot;locName&quot;</span><span class="s0">, </span><span class="s3">&quot;obsDt&quot;</span><span class="s0">, </span><span class="s3">&quot;howMany&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">zoom=</span><span class="s4">8.5</span><span class="s1">)</span>
<span class="s1">fig5.update_layout(title=</span><span class="s3">&quot;Rarities - Time-Series Graph&quot;</span><span class="s1">)</span>
<span class="s1">fig5.update_layout(mapbox_style=</span><span class="s3">&quot;open-street-map&quot;</span><span class="s1">)</span>
<span class="s1">fig5.update_layout(xaxis={</span><span class="s3">'type'</span><span class="s1">: </span><span class="s3">'date'</span><span class="s1">})</span>
<span class="s1">fig5.update_layout(xaxis={</span><span class="s3">'dtick' </span><span class="s1">: </span><span class="s4">86400000.0 </span><span class="s1">* </span><span class="s4">30</span><span class="s1">})</span>
<span class="s1">fig5.update_layout(legend={</span><span class="s3">'itemsizing'</span><span class="s1">: </span><span class="s3">'constant'</span><span class="s1">})</span>
<span class="s1">fig5.update_layout(transition={</span><span class="s3">'duration'</span><span class="s1">: </span><span class="s4">30</span><span class="s1">})</span>
<span class="s1">fig5.update_xaxes(range=[min_date</span><span class="s0">, </span><span class="s1">max_date])</span>
<span class="s1">fig5.update_layout(paper_bgcolor=colors[</span><span class="s3">'background'</span><span class="s1">])</span>

<span class="s2"># creating list of individual unique species sighted in pennsylvania for fig 3 below</span>
<span class="s1">species_unique_list = []</span>
<span class="s1">species_unique_list = df[</span><span class="s3">'comName'</span><span class="s1">].unique()</span>
<span class="s1">species_unique_list = sorted(species_unique_list)</span>
<span class="s1">species_counts_df = df.groupby([</span><span class="s3">'comName'</span><span class="s0">, </span><span class="s3">'date'</span><span class="s1">])[</span><span class="s3">'howMany'</span><span class="s1">].agg(</span><span class="s3">'sum'</span><span class="s1">).reset_index()</span>
<span class="s2">#species_counts_df.to_csv(r'C:/Users/mikea/Documents/Python Practice/test.csv', index = False)</span>
<span class="s2"># defining app</span>
<span class="s1">app = dash.Dash(__name__</span><span class="s0">, </span><span class="s1">external_stylesheets=[dbc.themes.BOOTSTRAP])</span>

<span class="s2"># set app layout parameters</span>
<span class="s1">app.layout = html.Div(style={</span><span class="s3">'backgroundColor'</span><span class="s1">: colors[</span><span class="s3">'background'</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">children=[</span>
    <span class="s1">html.H1(children=</span><span class="s3">'ChesCo Weekly Birder Dashboard'</span><span class="s0">, </span><span class="s1">style={</span>
        <span class="s3">'textAlign'</span><span class="s1">: </span><span class="s3">'center'</span><span class="s0">,</span>
        <span class="s3">'color'</span><span class="s1">: colors[</span><span class="s3">'text'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'fontSize'</span><span class="s1">: </span><span class="s4">48</span><span class="s0">,</span>
        <span class="s3">'font-family'</span><span class="s1">: </span><span class="s3">'monospace'</span>
    <span class="s1">})</span><span class="s0">,</span>

    <span class="s1">html.Div(children=</span><span class="s3">''' 
        Data sourced from eBird on: 03Sep2020. 
    '''</span><span class="s0">, </span><span class="s1">style={</span>
        <span class="s3">'textAlign'</span><span class="s1">: </span><span class="s3">'center'</span><span class="s0">,</span>
        <span class="s3">'color'</span><span class="s1">: colors[</span><span class="s3">'text'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'fontSize'</span><span class="s1">: </span><span class="s4">18</span>
    <span class="s1">})</span><span class="s0">,</span>

    <span class="s1">html.H1(children=</span><span class="s3">''' 
    Barcharts: 
    '''</span><span class="s0">, </span><span class="s1">style={</span>
        <span class="s3">'textAlign'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
        <span class="s3">'color'</span><span class="s1">: colors[</span><span class="s3">'text'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'fontSize'</span><span class="s1">: </span><span class="s4">32</span><span class="s0">,</span>
        <span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'1em'</span><span class="s0">,</span>
        <span class="s3">'marginBottom'</span><span class="s1">: </span><span class="s3">'1em'</span>
    <span class="s1">})</span><span class="s0">,</span>

    <span class="s1">html.Div(children=[</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Graph(</span>
                <span class="s1">figure=fig</span><span class="s0">,</span>
                <span class="s1">style={</span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'600'</span><span class="s1">}</span>
            <span class="s1">)</span><span class="s0">, </span><span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})])</span><span class="s0">,</span>

    <span class="s1">html.Div(children=[</span><span class="s3">'''Learn more about these birds (right click &gt; open in new tab): '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href = species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href = species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">1</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">2</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">3</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">6</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">7</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">8</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">9</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">10</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">11</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">12</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">13</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">13</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">14</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">14</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">15</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">16</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">16</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">17</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">17</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
       <span class="s1">html.Div(</span>
           <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">18</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">18</span><span class="s1">])</span><span class="s0">,</span>
           <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Link(species_df_for_dict[</span><span class="s3">'comName'</span><span class="s1">][</span><span class="s4">19</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=species_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">19</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})])</span><span class="s0">, </span><span class="s3">''' '''</span><span class="s0">,</span>

    <span class="s1">html.Div(children=[</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Graph(</span>
                <span class="s1">figure=fig2</span><span class="s0">,</span>
                <span class="s1">style={</span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'600'</span><span class="s0">, </span><span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'4em'</span><span class="s1">}</span>
            <span class="s1">)</span><span class="s0">, </span><span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})])</span><span class="s0">,</span>

    <span class="s1">html.Div(children=[</span><span class="s3">'''Learn more about these locations (right click &gt; open in new tab): '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">1</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">2</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">3</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">5</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">6</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">7</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">8</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">9</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">10</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">11</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">12</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">13</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">13</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">14</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">14</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">15</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">16</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">16</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">17</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">17</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">18</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">18</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})</span><span class="s0">, </span><span class="s3">''', '''</span><span class="s0">,</span>
           <span class="s1">html.Div(</span>
               <span class="s1">dcc.Link(hotspot_df_for_dict[</span><span class="s3">'locName'</span><span class="s1">][</span><span class="s4">19</span><span class="s1">]</span><span class="s0">, </span><span class="s1">href=hotspot_df_for_dict[</span><span class="s3">'link'</span><span class="s1">][</span><span class="s4">19</span><span class="s1">])</span><span class="s0">,</span>
               <span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})])</span><span class="s0">, </span><span class="s3">''' '''</span><span class="s0">,</span>

    <span class="s1">html.Div(children=</span><span class="s3">''' 
    Select from the dropdown below... 
    '''</span><span class="s0">, </span><span class="s1">style={</span>
        <span class="s3">'textAlign'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
        <span class="s3">'color'</span><span class="s1">: colors[</span><span class="s3">'text'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'fontSize'</span><span class="s1">: </span><span class="s4">20</span><span class="s0">,</span>
        <span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'4em'</span>
    <span class="s1">})</span><span class="s0">,</span>

    <span class="s1">dcc.Dropdown(</span>
        <span class="s1">id=</span><span class="s3">'yaxis-column'</span><span class="s0">,</span>
        <span class="s1">options=[{</span><span class="s3">'label'</span><span class="s1">: i</span><span class="s0">, </span><span class="s3">'value'</span><span class="s1">: i} </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">species_unique_list]</span><span class="s0">,</span>
        <span class="s1">value=species_unique_list[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">style={</span><span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'2em'</span><span class="s0">, </span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'50%'</span><span class="s0">, </span><span class="s3">'marginLeft'</span><span class="s1">: </span><span class="s3">'2em'</span><span class="s1">}</span>
    <span class="s1">)</span><span class="s0">,</span>

    <span class="s1">html.Div(children=[</span>
        <span class="s1">html.Div(</span>
            <span class="s1">dcc.Graph(</span>
                <span class="s1">id=</span><span class="s3">'indicator-graphic'</span><span class="s0">,</span>
                <span class="s1">style={</span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'600'</span><span class="s0">, </span><span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'1em'</span><span class="s1">}</span>
            <span class="s1">)</span><span class="s0">, </span><span class="s1">style={</span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s1">})])</span><span class="s0">,</span>

    <span class="s1">html.H1(children=</span><span class="s3">''' 
    Geographical Analysis and Maps: 
    '''</span><span class="s0">, </span><span class="s1">style={</span>
        <span class="s3">'textAlign'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">,</span>
        <span class="s3">'color'</span><span class="s1">: colors[</span><span class="s3">'text'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'fontSize'</span><span class="s1">: </span><span class="s4">32</span><span class="s0">,</span>
        <span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'2em'</span><span class="s0">,</span>
        <span class="s3">'marginBottom'</span><span class="s1">: </span><span class="s3">'1em'</span>
    <span class="s1">})</span><span class="s0">,</span>

    <span class="s1">dcc.Dropdown(</span>
        <span class="s1">id=</span><span class="s3">'yaxis-column_1'</span><span class="s0">,</span>
        <span class="s1">options=[{</span><span class="s3">'label'</span><span class="s1">: i</span><span class="s0">, </span><span class="s3">'value'</span><span class="s1">: i} </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">species_unique_list]</span><span class="s0">,</span>
        <span class="s1">value=species_unique_list[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">style={</span><span class="s3">'marginTop'</span><span class="s1">: </span><span class="s3">'2em'</span><span class="s0">, </span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'50%'</span><span class="s0">, </span><span class="s3">'marginLeft'</span><span class="s1">: </span><span class="s3">'2.5em'</span><span class="s1">}</span>
    <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">dcc.Graph(id=</span><span class="s3">'indicator-graphic-2'</span><span class="s0">,</span>
              <span class="s1">style={</span><span class="s3">'marginBottom'</span><span class="s1">: </span><span class="s3">'1em'</span><span class="s0">, </span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'80%'</span><span class="s0">, </span><span class="s3">'align'</span><span class="s1">: </span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s0">, </span><span class="s3">'height'</span><span class="s1">: </span><span class="s4">400</span><span class="s1">})</span><span class="s0">,</span>

    <span class="s1">dcc.Graph(</span>
        <span class="s1">id=</span><span class="s3">'example-graph5'</span><span class="s0">,</span>
        <span class="s1">figure=fig5</span><span class="s0">,</span>
        <span class="s1">style={</span><span class="s3">'marginBottom'</span><span class="s1">: </span><span class="s3">'3em'</span><span class="s0">, </span><span class="s3">'width'</span><span class="s1">: </span><span class="s3">'80%'</span><span class="s0">, </span><span class="s3">'align'</span><span class="s1">: </span><span class="s3">'right'</span><span class="s0">, </span><span class="s3">'display'</span><span class="s1">: </span><span class="s3">'inline'</span><span class="s0">, </span><span class="s3">'height'</span><span class="s1">: </span><span class="s4">400</span><span class="s1">}</span>
    <span class="s1">)</span>
<span class="s1">])</span>

<span class="s2"># setting up callback for interactive plot</span>
<span class="s1">@app.callback(</span>
    <span class="s1">Output(</span><span class="s3">'indicator-graphic'</span><span class="s0">, </span><span class="s3">'figure'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">[Input(</span><span class="s3">'yaxis-column'</span><span class="s0">, </span><span class="s3">'value'</span><span class="s1">)])</span>
<span class="s2"># defining function for updating the plot based on user selection in dropdown</span>
<span class="s0">def </span><span class="s1">update_graph(yaxis_column_name):</span>
    <span class="s2"># data frame containing unique</span>
    <span class="s1">updated_df = species_counts_df[species_counts_df[</span><span class="s3">'comName'</span><span class="s1">] == yaxis_column_name]</span>
    <span class="s2"># figure 3 - number of sightings by species for each day of the week w. interactive species selection</span>
    <span class="s1">data = updated_df</span>
    <span class="s1">graph_data1 = go.Bar(x=updated_df[</span><span class="s3">'date'</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">y=updated_df[</span><span class="s3">'howMany'</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">hoverinfo=</span><span class="s3">'y'</span><span class="s0">,</span>
                         <span class="s1">width=</span><span class="s4">1000 </span><span class="s1">* </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">24 </span><span class="s1">* </span><span class="s4">0.8</span>
                         <span class="s1">)</span>
    <span class="s1">x=updated_df[</span><span class="s3">'date'</span><span class="s1">]</span>
    <span class="s1">y=updated_df[</span><span class="s3">'howMany'</span><span class="s1">]</span>
    <span class="s1">barmode=</span><span class="s3">'overlay'</span>
    <span class="s1">layout = go.Layout(barmode=barmode</span><span class="s0">,</span>
                           <span class="s1">title=</span><span class="s3">'Sightings by Day for Past Week'</span><span class="s1">)</span>
    <span class="s1">fig3 = go.Figure(data=graph_data1</span><span class="s0">, </span><span class="s1">layout=layout)</span>

    <span class="s1">fig3.update_layout(</span>
        <span class="s1">title={</span>
            <span class="s3">'y'</span><span class="s1">: </span><span class="s4">0.98</span><span class="s0">,</span>
            <span class="s3">'x'</span><span class="s1">: </span><span class="s4">0.5</span><span class="s0">,</span>
            <span class="s3">'xanchor'</span><span class="s1">: </span><span class="s3">'center'</span><span class="s0">,</span>
            <span class="s3">'yanchor'</span><span class="s1">: </span><span class="s3">'top'</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">margin=dict(</span>
            <span class="s1">b=</span><span class="s4">280</span><span class="s0">,</span>
            <span class="s1">t=</span><span class="s4">100</span><span class="s0">,</span>
            <span class="s1">pad=</span><span class="s4">10</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s2">#minc = updated_df['howMany'].min()</span>
    <span class="s0">if </span><span class="s1">updated_df[</span><span class="s3">'howMany'</span><span class="s1">].max() &lt; </span><span class="s4">500</span><span class="s1">:</span>
        <span class="s1">maxc = updated_df[</span><span class="s3">'howMany'</span><span class="s1">].max()</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">maxc = </span><span class="s4">1000</span>
    <span class="s1">minc = </span><span class="s4">0</span>
    <span class="s1">min = species_counts_df[</span><span class="s3">'date'</span><span class="s1">].min() - timedelta(days=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">max = species_counts_df[</span><span class="s3">'date'</span><span class="s1">].max() + timedelta(days=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">min = min.date()</span>
    <span class="s1">max = max.date()</span>

    <span class="s1">fig3.update_layout(xaxis_autorange = </span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig3.update_layout(yaxis_autorange=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig3.update_layout(xaxis_range =[min</span><span class="s0">, </span><span class="s1">max])</span>
    <span class="s1">fig3.update_layout(yaxis_range=[minc</span><span class="s0">, </span><span class="s1">maxc])</span>
    <span class="s1">fig3.update_layout(margin={</span><span class="s3">'l'</span><span class="s1">: </span><span class="s4">40</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: </span><span class="s4">40</span><span class="s0">, </span><span class="s3">'t'</span><span class="s1">: </span><span class="s4">10</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">, </span><span class="s1">hovermode=</span><span class="s3">'closest'</span><span class="s1">)</span>
    <span class="s1">fig3.update_layout(paper_bgcolor=colors[</span><span class="s3">'background'</span><span class="s1">])</span>
    <span class="s1">fig3.update_layout(bargap=</span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">fig3.update_xaxes(type=</span><span class="s3">'date'</span><span class="s1">)</span>

    <span class="s0">return </span><span class="s1">fig3</span>


<span class="s1">sightings_gdf = geopandas.GeoDataFrame(</span>
    <span class="s1">df</span><span class="s0">, </span><span class="s1">geometry=geopandas.points_from_xy(df.lng</span><span class="s0">, </span><span class="s1">df.lat))</span>

<span class="s1">sightings_gdf[</span><span class="s3">'howMany'</span><span class="s1">] = sightings_gdf[</span><span class="s3">'howMany'</span><span class="s1">].fillna(</span><span class="s3">'1'</span><span class="s1">)</span>
<span class="s1">sightings_gdf[</span><span class="s3">&quot;howMany&quot;</span><span class="s1">] = pd.to_numeric(sightings_gdf[</span><span class="s3">&quot;howMany&quot;</span><span class="s1">])</span>
<span class="s1">sightings_gdf[</span><span class="s3">&quot;lat&quot;</span><span class="s1">] = pd.to_numeric(sightings_gdf[</span><span class="s3">&quot;lat&quot;</span><span class="s1">])</span>
<span class="s1">sightings_gdf[</span><span class="s3">&quot;lng&quot;</span><span class="s1">] = pd.to_numeric(sightings_gdf[</span><span class="s3">&quot;lng&quot;</span><span class="s1">])</span>


<span class="s1">sightings_gdf_grouped = sightings_gdf.groupby([</span><span class="s3">'comName'</span><span class="s0">, </span><span class="s3">'lat'</span><span class="s0">,</span>
                                               <span class="s3">'lng'</span><span class="s0">, </span><span class="s3">'locName'</span><span class="s1">])[</span><span class="s3">'howMany'</span><span class="s1">].agg(</span><span class="s3">'sum'</span><span class="s1">).reset_index()</span>


<span class="s1">@app.callback(</span>
    <span class="s1">Output(</span><span class="s3">'indicator-graphic-2'</span><span class="s0">, </span><span class="s3">'figure'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">[Input(</span><span class="s3">'yaxis-column_1'</span><span class="s0">, </span><span class="s3">'value'</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">update_graph_2(yaxis_column_name_1):</span>

    <span class="s1">updated_gdf = sightings_gdf_grouped[sightings_gdf_grouped[</span><span class="s3">'comName'</span><span class="s1">] == yaxis_column_name_1]</span>

    <span class="s1">max_sightings = updated_gdf[</span><span class="s3">'howMany'</span><span class="s1">].max()</span>
    <span class="s1">min_sightings = updated_gdf[</span><span class="s3">'howMany'</span><span class="s1">].min()</span>

    <span class="s1">fig6 = px.scatter_mapbox(updated_gdf</span><span class="s0">, </span><span class="s1">lat=</span><span class="s3">&quot;lat&quot;</span><span class="s0">, </span><span class="s1">lon=</span><span class="s3">&quot;lng&quot;</span><span class="s0">,</span>
                             <span class="s1">size=</span><span class="s3">&quot;howMany&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;howMany&quot;</span><span class="s0">, </span><span class="s1">hover_name=</span><span class="s3">&quot;comName&quot;</span><span class="s0">,</span>
                             <span class="s1">range_color=(min_sightings</span><span class="s0">, </span><span class="s1">max_sightings)</span><span class="s0">,</span>
                             <span class="s1">hover_data=[</span><span class="s3">&quot;locName&quot;</span><span class="s0">, </span><span class="s3">&quot;howMany&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">zoom=</span><span class="s4">8.5</span><span class="s1">)</span>
    <span class="s1">fig6.update_layout(title=</span><span class="s3">&quot;Species - Sightings This Week (Select from dropdown)&quot;</span><span class="s1">)</span>
    <span class="s1">fig6.update_layout(mapbox_style=</span><span class="s3">&quot;open-street-map&quot;</span><span class="s1">)</span>
    <span class="s1">fig6.update_layout(paper_bgcolor=colors[</span><span class="s3">'background'</span><span class="s1">])</span>

    <span class="s0">return </span><span class="s1">fig6</span>

<span class="s0">if </span><span class="s1">__name__ == </span><span class="s3">'__main__'</span><span class="s1">:</span>
    <span class="s1">app.run_server(debug=</span><span class="s0">True</span><span class="s1">)</span>

</pre>
</body>
</html>